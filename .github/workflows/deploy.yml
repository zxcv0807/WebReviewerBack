# .github/workflows/deploy.yml

name: Deploy to AWS EC2 (Self-Hosted)

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted # 모든 작업을 self-hosted runner에서 실행

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Create .env file
        env:
          ENV_FILE_CONTENT: ${{ secrets.ENV_FILE }}
        run: echo "$ENV_FILE_CONTENT" > .env

      - name: Add execute permission to deploy script
        run: chmod +x ./deploy_v2.sh
      
      - name: Deploy Application
        run: ./deploy_v2.sh